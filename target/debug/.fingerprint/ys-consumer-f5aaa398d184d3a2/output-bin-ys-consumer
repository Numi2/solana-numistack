{"$message_type":"diagnostic","message":"unreachable expression","code":{"code":"unreachable_code","explanation":null},"level":"warning","spans":[{"file_name":"crates/ys-consumer/src/main.rs","byte_start":17309,"byte_end":17315,"line_start":364,"line_end":364,"column_start":5,"column_end":11,"is_primary":true,"text":[{"text":"    Ok(())","highlight_start":5,"highlight_end":11}],"label":"unreachable expression","suggested_replacement":null,"suggestion_applicability":null,"expansion":null},{"file_name":"crates/ys-consumer/src/main.rs","byte_start":10160,"byte_end":17304,"line_start":243,"line_end":363,"column_start":5,"column_end":6,"is_primary":false,"text":[{"text":"    loop {","highlight_start":5,"highlight_end":11},{"text":"        // connect + subscribe (with shutdown support)","highlight_start":1,"highlight_end":55},{"text":"        let mut builder = GeyserGrpcClient::build_from_static(endpoint_static);","highlight_start":1,"highlight_end":80},{"text":"        if let Some(tok) = x_token.clone() {","highlight_start":1,"highlight_end":45},{"text":"            builder = match builder.x_token(Some(tok)) { Ok(b) => b, Err(e) => { error!(\"token set error: {e}\"); tokio::time::sleep(reconnect_backoff).await; continue; } };","highlight_start":1,"highlight_end":173},{"text":"        }","highlight_start":1,"highlight_end":10},{"text":"        let mut client = match builder.connect().await { Ok(c) => c, Err(e) => { error!(\"connect error: {e}\"); counter!(\"ys_connect_fail_total\").increment(1); tokio::time::sleep(jitter(reconnect_backoff)).await; reconnect_backoff = (reconnect_backoff * 2).min(backoff_max); continue; } };","highlight_start":1,"highlight_end":289},{"text":"        let (mut tx, mut rx) = match client.subscribe().await { Ok(sr) => sr, Err(e) => { error!(\"subscribe error: {e}\"); counter!(\"ys_subscribe_fail_total\").increment(1); tokio::time::sleep(jitter(reconnect_backoff)).await; reconnect_backoff = (reconnect_backoff * 2).min(backoff_max); continue; } };","highlight_start":1,"highlight_end":302},{"text":"        if let Err(e) = tx.send(req.clone()).await { error!(\"send subscribe request failed: {e}\"); counter!(\"ys_send_fail_total\").increment(1); tokio::time::sleep(jitter(reconnect_backoff)).await; reconnect_backoff = (reconnect_backoff * 2).min(backoff_max); continue; }","highlight_start":1,"highlight_end":271},{"text":"        reconnect_backoff = backoff_min;","highlight_start":1,"highlight_end":41},{"text":"        info!(\"connected to Yellowstone; forwarding to {}\", uds_path);","highlight_start":1,"highlight_end":71},{"text":"","highlight_start":1,"highlight_end":1},{"text":"        loop {","highlight_start":1,"highlight_end":15},{"text":"            let next_fut = rx.next();","highlight_start":1,"highlight_end":38},{"text":"            tokio::select! {","highlight_start":1,"highlight_end":29},{"text":"                _ = &mut shutdown_sig => { info!(\"shutting down\"); return Ok(()); }","highlight_start":1,"highlight_end":84},{"text":"                res = tokio::time::timeout(idle_timeout, next_fut) => {","highlight_start":1,"highlight_end":72},{"text":"                    match res {","highlight_start":1,"highlight_end":32},{"text":"                        Ok(Some(Ok(upd))) => {","highlight_start":1,"highlight_end":47},{"text":"                            match upd.update_oneof {","highlight_start":1,"highlight_end":53},{"text":"            Some(subscribe_update::UpdateOneof::Transaction(t)) => {","highlight_start":1,"highlight_end":69},{"text":"                let mut sig = [0u8; 64];","highlight_start":1,"highlight_end":41},{"text":"                // Extract signature from transaction if available","highlight_start":1,"highlight_end":67},{"text":"                if let Some(tx_data) = &t.transaction {","highlight_start":1,"highlight_end":56},{"text":"                    if tx_data.signature.len() == 64 {","highlight_start":1,"highlight_end":55},{"text":"                        sig.copy_from_slice(&tx_data.signature);","highlight_start":1,"highlight_end":65},{"text":"                    }","highlight_start":1,"highlight_end":22},{"text":"                }","highlight_start":1,"highlight_end":18},{"text":"                let rec = Record::Tx(TxUpdate {","highlight_start":1,"highlight_end":48},{"text":"                    slot: t.slot,","highlight_start":1,"highlight_end":34},{"text":"                    signature: sig,","highlight_start":1,"highlight_end":36},{"text":"                    err: t.transaction.as_ref().and_then(|tx| tx.meta.as_ref()).and_then(|m| m.err.as_ref().cloned()).map(|e| format!(\"{:?}\", e)),","highlight_start":1,"highlight_end":147},{"text":"                    vote: false, // is_vote not available in new structure","highlight_start":1,"highlight_end":75},{"text":"                });","highlight_start":1,"highlight_end":20},{"text":"                if let Ok(buf) = encode_record_with(&rec, EncodeOptions::latency_uds()) {","highlight_start":1,"highlight_end":90},{"text":"                    if let Some(txq) = &txq_opt {","highlight_start":1,"highlight_end":50},{"text":"                        if txq.try_send(buf).is_err() { counter!(\"ys_consumer_dropped_total\").increment(1); }","highlight_start":1,"highlight_end":110},{"text":"                    } else if let Some(q) = &spsc_q_opt {","highlight_start":1,"highlight_end":58},{"text":"                        if q.push(buf).is_err() { counter!(\"ys_consumer_dropped_total\").increment(1); }","highlight_start":1,"highlight_end":104},{"text":"                    }","highlight_start":1,"highlight_end":22},{"text":"                }","highlight_start":1,"highlight_end":18},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"            Some(subscribe_update::UpdateOneof::Account(a)) => {","highlight_start":1,"highlight_end":65},{"text":"                if let Some(acc) = &a.account {","highlight_start":1,"highlight_end":48},{"text":"                    // Decode base58 into fixed arrays","highlight_start":1,"highlight_end":55},{"text":"                    let pubkey = bs58::decode(&acc.pubkey)","highlight_start":1,"highlight_end":59},{"text":"                        .into_vec()","highlight_start":1,"highlight_end":36},{"text":"                        .ok()","highlight_start":1,"highlight_end":30},{"text":"                        .and_then(|v| v.try_into().ok())","highlight_start":1,"highlight_end":57},{"text":"                        .unwrap_or([0; 32]);","highlight_start":1,"highlight_end":45},{"text":"                    let owner = bs58::decode(&acc.owner)","highlight_start":1,"highlight_end":57},{"text":"                        .into_vec()","highlight_start":1,"highlight_end":36},{"text":"                        .ok()","highlight_start":1,"highlight_end":30},{"text":"                        .and_then(|v| v.try_into().ok())","highlight_start":1,"highlight_end":57},{"text":"                        .unwrap_or([0; 32]);","highlight_start":1,"highlight_end":45},{"text":"                    let aref = RecordRef::Account(AccountUpdateRef {","highlight_start":1,"highlight_end":69},{"text":"                        slot: a.slot,","highlight_start":1,"highlight_end":38},{"text":"                        is_startup: a.is_startup,","highlight_start":1,"highlight_end":50},{"text":"                        pubkey,","highlight_start":1,"highlight_end":32},{"text":"                        lamports: acc.lamports,","highlight_start":1,"highlight_end":48},{"text":"                        owner,","highlight_start":1,"highlight_end":31},{"text":"                        executable: acc.executable,","highlight_start":1,"highlight_end":52},{"text":"                        rent_epoch: acc.rent_epoch,","highlight_start":1,"highlight_end":52},{"text":"                        data: &acc.data,","highlight_start":1,"highlight_end":41},{"text":"                    });","highlight_start":1,"highlight_end":24},{"text":"                    if let Ok(buf) = encode_record_ref_with(&aref, EncodeOptions::latency_uds()) {","highlight_start":1,"highlight_end":99},{"text":"                        if let Some(txq) = &txq_opt {","highlight_start":1,"highlight_end":54},{"text":"                            if txq.try_send(buf).is_err() { counter!(\"ys_consumer_dropped_total\").increment(1); }","highlight_start":1,"highlight_end":114},{"text":"                        } else if let Some(q) = &spsc_q_opt {","highlight_start":1,"highlight_end":62},{"text":"                            if q.push(buf).is_err() { counter!(\"ys_consumer_dropped_total\").increment(1); }","highlight_start":1,"highlight_end":108},{"text":"                        }","highlight_start":1,"highlight_end":26},{"text":"                    }","highlight_start":1,"highlight_end":22},{"text":"                }","highlight_start":1,"highlight_end":18},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"            Some(subscribe_update::UpdateOneof::Block(b)) => {","highlight_start":1,"highlight_end":63},{"text":"                let bh = if !b.blockhash.is_empty() {","highlight_start":1,"highlight_end":54},{"text":"                    bs58::decode(&b.blockhash).into_vec().ok().and_then(|v| v.try_into().ok())","highlight_start":1,"highlight_end":95},{"text":"                } else { None };","highlight_start":1,"highlight_end":33},{"text":"                // leader field not available in new proto version, set to None","highlight_start":1,"highlight_end":80},{"text":"                let ld = None;","highlight_start":1,"highlight_end":31},{"text":"                let block_time = b.block_time.as_ref().and_then(|ts| if ts.timestamp != 0 { Some(ts.timestamp) } else { None });","highlight_start":1,"highlight_end":129},{"text":"                let rec = Record::Block(BlockMeta {","highlight_start":1,"highlight_end":52},{"text":"                    slot: b.slot,","highlight_start":1,"highlight_end":34},{"text":"                    blockhash: bh,","highlight_start":1,"highlight_end":35},{"text":"                    parent_slot: if b.parent_slot > 0 { b.parent_slot - 1 } else { 0 },","highlight_start":1,"highlight_end":88},{"text":"                    rewards_len: b.rewards.as_ref().map(|r| r.rewards.len()).unwrap_or(0) as u32,","highlight_start":1,"highlight_end":98},{"text":"                    block_time_unix: block_time,","highlight_start":1,"highlight_end":49},{"text":"                    leader: ld,","highlight_start":1,"highlight_end":32},{"text":"                });","highlight_start":1,"highlight_end":20},{"text":"                if let Ok(buf) = encode_record_with(&rec, EncodeOptions::latency_uds()) {","highlight_start":1,"highlight_end":90},{"text":"                    if let Some(txq) = &txq_opt {","highlight_start":1,"highlight_end":50},{"text":"                        if txq.try_send(buf).is_err() { counter!(\"ys_consumer_dropped_total\").increment(1); }","highlight_start":1,"highlight_end":110},{"text":"                    } else if let Some(q) = &spsc_q_opt {","highlight_start":1,"highlight_end":58},{"text":"                        if q.push(buf).is_err() { counter!(\"ys_consumer_dropped_total\").increment(1); }","highlight_start":1,"highlight_end":104},{"text":"                    }","highlight_start":1,"highlight_end":22},{"text":"                }","highlight_start":1,"highlight_end":18},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"            Some(subscribe_update::UpdateOneof::Slot(s)) => {","highlight_start":1,"highlight_end":62},{"text":"                let rec = Record::Slot { slot: s.slot, parent: s.parent, status: s.status as u8 };","highlight_start":1,"highlight_end":99},{"text":"                if let Ok(buf) = encode_record_with(&rec, EncodeOptions::latency_uds()) {","highlight_start":1,"highlight_end":90},{"text":"                    if let Some(txq) = &txq_opt {","highlight_start":1,"highlight_end":50},{"text":"                        if txq.try_send(buf).is_err() { counter!(\"ys_consumer_dropped_total\").increment(1); }","highlight_start":1,"highlight_end":110},{"text":"                    } else if let Some(q) = &spsc_q_opt {","highlight_start":1,"highlight_end":58},{"text":"                        if q.push(buf).is_err() { counter!(\"ys_consumer_dropped_total\").increment(1); }","highlight_start":1,"highlight_end":104},{"text":"                    }","highlight_start":1,"highlight_end":22},{"text":"                }","highlight_start":1,"highlight_end":18},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"            _ => {}","highlight_start":1,"highlight_end":20},{"text":"                            }","highlight_start":1,"highlight_end":30},{"text":"                        }","highlight_start":1,"highlight_end":26},{"text":"                        Ok(Some(Err(e))) => { error!(\"stream error: {e}\"); break; }","highlight_start":1,"highlight_end":84},{"text":"                        Ok(None) => { error!(\"stream closed by server\"); break; }","highlight_start":1,"highlight_end":82},{"text":"                        Err(_) => { counter!(\"ys_idle_timeouts_total\").increment(1); error!(\"idle timeout (no updates for {:?})\", idle_timeout); break; }","highlight_start":1,"highlight_end":154},{"text":"                    }","highlight_start":1,"highlight_end":22},{"text":"                }","highlight_start":1,"highlight_end":18},{"text":"            }","highlight_start":1,"highlight_end":14},{"text":"        }","highlight_start":1,"highlight_end":10},{"text":"        counter!(\"ys_reconnects_total\").increment(1);","highlight_start":1,"highlight_end":54},{"text":"        tokio::time::sleep(jitter(reconnect_backoff)).await;","highlight_start":1,"highlight_end":61},{"text":"        reconnect_backoff = (reconnect_backoff * 2).min(backoff_max);","highlight_start":1,"highlight_end":70},{"text":"    }","highlight_start":1,"highlight_end":6}],"label":"any code following this expression is unreachable","suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[{"message":"`#[warn(unreachable_code)]` on by default","code":null,"level":"note","spans":[],"children":[],"rendered":null}],"rendered":"\u001b[0m\u001b[1m\u001b[33mwarning\u001b[0m\u001b[0m\u001b[1m: unreachable expression\u001b[0m\n\u001b[0m   \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m--> \u001b[0m\u001b[0mcrates/ys-consumer/src/main.rs:364:5\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m243\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m/\u001b[0m\u001b[0m \u001b[0m\u001b[0m    loop {\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m244\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m        // connect + subscribe (with shutdown support)\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m245\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m        let mut builder = GeyserGrpcClient::build_from_static(endpoint_static);\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m246\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m        if let Some(tok) = x_token.clone() {\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m...\u001b[0m\u001b[0m   \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m362\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m        reconnect_backoff = (reconnect_backoff * 2).min(backoff_max);\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m363\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m    }\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|_____-\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12many code following this expression is unreachable\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m364\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m   \u001b[0m\u001b[0m    Ok(())\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m       \u001b[0m\u001b[0m\u001b[1m\u001b[33m^^^^^^\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[33munreachable expression\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m= \u001b[0m\u001b[0m\u001b[1mnote\u001b[0m\u001b[0m: `#[warn(unreachable_code)]` on by default\u001b[0m\n\n"}
{"$message_type":"diagnostic","message":"variable does not need to be mutable","code":{"code":"unused_mut","explanation":null},"level":"warning","spans":[{"file_name":"crates/ys-consumer/src/main.rs","byte_start":10087,"byte_end":10103,"line_start":240,"line_end":240,"column_start":9,"column_end":25,"is_primary":true,"text":[{"text":"    let mut shutdown_sig = signal::ctrl_c();","highlight_start":9,"highlight_end":25}],"label":null,"suggested_replacement":null,"suggestion_applicability":null,"expansion":null}],"children":[{"message":"`#[warn(unused_mut)]` on by default","code":null,"level":"note","spans":[],"children":[],"rendered":null},{"message":"remove this `mut`","code":null,"level":"help","spans":[{"file_name":"crates/ys-consumer/src/main.rs","byte_start":10087,"byte_end":10091,"line_start":240,"line_end":240,"column_start":9,"column_end":13,"is_primary":true,"text":[{"text":"    let mut shutdown_sig = signal::ctrl_c();","highlight_start":9,"highlight_end":13}],"label":null,"suggested_replacement":"","suggestion_applicability":"MachineApplicable","expansion":null}],"children":[],"rendered":null}],"rendered":"\u001b[0m\u001b[1m\u001b[33mwarning\u001b[0m\u001b[0m\u001b[1m: variable does not need to be mutable\u001b[0m\n\u001b[0m   \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m--> \u001b[0m\u001b[0mcrates/ys-consumer/src/main.rs:240:9\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\n\u001b[0m\u001b[1m\u001b[38;5;12m240\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m \u001b[0m\u001b[0m    let mut shutdown_sig = signal::ctrl_c();\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m         \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m----\u001b[0m\u001b[0m\u001b[1m\u001b[33m^^^^^^^^^^^^\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m         \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\u001b[0m         \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12mhelp: remove this `mut`\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\n\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m= \u001b[0m\u001b[0m\u001b[1mnote\u001b[0m\u001b[0m: `#[warn(unused_mut)]` on by default\u001b[0m\n\n"}
{"$message_type":"diagnostic","message":"2 warnings emitted","code":null,"level":"warning","spans":[],"children":[],"rendered":"\u001b[0m\u001b[1m\u001b[33mwarning\u001b[0m\u001b[0m\u001b[1m: 2 warnings emitted\u001b[0m\n\n"}
